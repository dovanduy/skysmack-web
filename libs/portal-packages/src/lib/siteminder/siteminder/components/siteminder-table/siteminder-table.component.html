<mat-card>
    <table cellspacing="0" cellpadding="0" class="mat-table">
        <thead class="mat-header-row">
            <!-- 1st header row -->
            <tr>
                <!-- Date -->
                <th *ngIf="dateColumn$ | async as dateColumn" rowspan="4"
                    class="table-cell mat-header-cell border-right">
                    {{  dateColumn.title }}
                </th>
                <ng-container *ngFor="let ltc of lodgingTypeColumns$ | async; let first = first; let last = last">
                    <!-- Lodging Type -->
                    <th [attr.colspan]="calculateLodgingTypeColspan(ltc.id)"
                        class="table-cell mat-header-cell lodging-type-column-divider border-left border-right">
                        {{ ltc.title }}
                    </th>
                </ng-container>
            </tr>

            <!-- 2nd header row -->
            <tr>
                <ng-container *ngFor="let ltc of lodgingTypeColumns$ | async">
                    <!-- Available -->
                    <ng-container *ngIf="availabilityColumns$ | async as availabilityColumns">
                        <th rowspan="3" class="table-cell mat-header-cell border-left border-right">
                            {{ availabilityColumns[ltc.id]?.title }}
                        </th>
                    </ng-container>
                    <!-- Rateplan -->
                    <ng-container *ngIf="ratePlanColumns$ | async as rpc">
                        <ng-container *ngFor="let ratePlanColumn of rpc[ltc.id]; let first = first; let last = last">
                            <th [attr.colspan]="calculateRatePlanColspan(ratePlanColumn.id)"
                                class="table-cell mat-header-cell border-right">
                                {{ ratePlanColumn.title }}
                            </th>
                        </ng-container>
                    </ng-container>
                </ng-container>
            </tr>

            <!-- 3rd header row -->
            <tr>
                <ng-container *ngFor="let ltc of lodgingTypeColumns$ | async">
                    <!-- Rateplan -->
                    <ng-container *ngIf="ratePlanColumns$ | async as rpc">
                        <ng-container *ngFor="let ratePlanColumn of rpc[ltc.id]">
                            <!-- Rates Summary -->
                            <ng-container *ngIf="rateSummaryColumns$ | async as rsc">
                                <th colspan="2" class="table-cell mat-header-cell border-right-light">
                                    {{ rsc[ratePlanColumn.id]?.title }}
                                </th>
                            </ng-container>

                            <!-- Channels (show if expanded) -->
                            <ng-container *ngIf="channelsColumns$ | async as cc">
                                <ng-container
                                    *ngFor="let channelColumn of cc[ratePlanColumn.id]; let first = first; let last = last">
                                    <th colspan="2" [ngClass]="{ 'border-right-light': !last }"
                                        class="table-cell mat-header-cell border-right">
                                        {{ channelColumn.title }}
                                    </th>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </ng-container>
            </tr>

            <!-- 4th header row -->
            <tr>
                <ng-container *ngFor="let ltc of lodgingTypeColumns$ | async">
                    <!-- Rateplan -->
                    <ng-container *ngIf="ratePlanColumns$ | async as rpc">
                        <ng-container *ngFor="let ratePlanColumn of rpc[ltc.id]">
                            <!-- Rates Summary -->
                            <ng-container *ngIf="rateSummaryColumns$ | async as rsc">
                                <!-- Rates -->
                                <th class="table-cell mat-header-cell border-right-light">
                                    Rates
                                </th>
                                <!-- Restrictions -->
                                <th class="table-cell mat-header-cell border-right-light">
                                    Restrictions
                                </th>
                            </ng-container>
                            <!-- Channels (show if expanded) -->
                            <ng-container *ngIf="channelsColumns$ | async as cc">
                                <ng-container
                                    *ngFor="let channelColumn of cc[ratePlanColumn.id]; let first = first; let last = last">
                                    <!-- Rates -->
                                    <th [ngClass]="{ 'border-right-light': !last }"
                                        class="table-cell mat-header-cell border-right">
                                        Rate
                                    </th>
                                    <!-- Restrictions -->
                                    <th [ngClass]="{ 'border-right-light': !last }"
                                        class="table-cell mat-header-cell border-right">
                                        Restrictions
                                    </th>
                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </ng-container>
            </tr>

        </thead>
        <tbody>
            <tr *ngFor="let date of dateRows$ | async; let firstRow = first"
                [ngClass]="'row-weekday-' + (date | weekday)">

                <!-- Date -->
                <td class="table-cell mat-cell border-right" [matTooltip]="(date | weekday : 'readable')">
                    {{ date | date: 'dd-MM-yyyy' }}
                </td>

                <ng-container *ngFor="let ltc of lodgingTypeColumns$ | async">
                    <!-- Available -->
                    <td class="table-cell mat-cell border-left border-right"
                        [ngClass]="{ 'monday-row': (date | weekday) === 1 }">
                        <ng-container *ngIf="availabilityCells$ | async as availabilityCells">
                            <ss-siteminder-availability [data]="availabilityCells[date][ltc.id]">
                            </ss-siteminder-availability>
                        </ng-container>
                    </td>

                    <!-- Rateplan -->
                    <ng-container *ngIf="ratePlanColumns$ | async as rpc">
                        <ng-container *ngFor="let ratePlanColumn of rpc[ltc.id]; let last = last">
                            <!-- Rates Summary: Rates -->
                            <td class="table-cell mat-cell border-right-light"
                                [ngClass]="{ 'monday-row': (date | weekday) === 1 }">
                                <ng-container *ngIf="rateSummaryCells$ | async as rsc">
                                    <ss-siteminder-rate-summary [data]="rsc[date][ratePlanColumn.id][ltc.id]">
                                    </ss-siteminder-rate-summary>
                                </ng-container>
                            </td>

                            <!-- Rates Summary: Restrictions -->
                            <td class="table-cell mat-cell border-right-light"
                                [ngClass]="{ 'monday-row': (date | weekday) === 1 }">
                                <ng-container *ngIf="rateSummaryCells$ | async as rsc">
                                    <ss-siteminder-restrictions-summary [data]="">
                                    </ss-siteminder-restrictions-summary>
                                </ng-container>
                            </td>

                            <!-- Channels (show if expanded) -->
                            <ng-container *ngIf="channelsColumns$ | async as cc">
                                <ng-container *ngIf="channelsCells$ | async as channelCells">

                                    <ng-container *ngFor="let channelColumn of cc[ratePlanColumn.id]; let last = last">
                                        <!-- Channel: Rates -->
                                        <td [ngClass]="{ 'border-right-light': !last, 'monday-row': (date | weekday) === 1 }"
                                            class="table-cell mat-cell border-right">
                                            <ss-siteminder-rate
                                                [data]="channelCells[date][ratePlanColumn.id][ltc.id][ltc.id + ':' + ratePlanColumn.id + ':' + channelColumn.id]">
                                            </ss-siteminder-rate>
                                        </td>
                                        <!-- Channel: Restrictions -->
                                        <td [ngClass]="{ 'border-right-light': !last, 'monday-row': (date | weekday) === 1 }"
                                            class="table-cell mat-cell border-right">
                                            <!-- Restrictions -->
                                            <ss-siteminder-restrictions [data]="">
                                            </ss-siteminder-restrictions>
                                        </td>
                                    </ng-container>

                                </ng-container>
                            </ng-container>
                        </ng-container>
                    </ng-container>
                </ng-container>
            </tr>
        </tbody>
    </table>
</mat-card>