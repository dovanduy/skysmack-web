<nav *ngIf="skysmack$ | async as skysmack" class="docs-navbar-header">
  <!-- APP DRAWER -->
  <a class="link" mat-icon-button (click)="uiStore.toggleMenuFor('drawer')"
    title="{{ 'UI.TOP_BAR.PACKAGES'| translate}}">
    <mat-icon aria-label="Open packages">apps</mat-icon>
  </a>

  <a mat-button class="link" routerLink="/" (click)="uiStore.setPackageDrawerStatus(false)" aria-label="Skysmack">
    <span>{{ skysmack.name }}</span>
  </a>

  <div class="flex-spacer"></div>

  <!-- ONLINE STATUS -->
  <ss-online-status></ss-online-status>

  <!-- QUEUE -->
  <!-- *isAuthenticated -->
  <ss-queue></ss-queue>

  <!-- SEARCH -->
  <button mat-icon-button class="link" (click)="uiStore.toggleMenuFor('search')" *isAuthenticated>
    <mat-icon>search</mat-icon>
  </button>
  <div *ngIf="menu$ | async as menu" class="search-bar" [ngClass]="{ 'open' : menu.search }">
    <input type="text" [placeholder]="'UI.TOP_BAR.SEARCH' | translate" class="search-field" />
  </div>

  <!-- CHAT -->
  <!-- <ng-container *isAuthenticated>
    <button mat-icon-button class="link" [matMenuTriggerFor]="chatMenu">
      <mat-icon aria-label="Open chat">chat</mat-icon>
    </button>
    <mat-menu overlapTrigger="false" #chatMenu="matMenu">
      <span [translate]="'UI.TOP_BAR.NO_CONVER'"></span>
    </mat-menu>
  </ng-container> -->

  <!-- NOTIFICATIONS -->
  <!-- <ng-container *isAuthenticated>
    <button class="link"  mat-icon-button [matMenuTriggerFor]="notificationsMenu">
      <mat-icon>notifications</mat-icon>
    </button>
    <mat-menu overlapTrigger="false" #notificationsMenu="matMenu">
      <span [translate]="'UI.TOP_BAR.NO_NOTI'"></span>
    </mat-menu>
  </ng-container> -->

  <!-- LANGUAGE -->
  <ss-language-select></ss-language-select>

  <!-- PROVIDED MENUS -->
  <ng-container *ngFor="let menuArea of menuAreas$ | async; let last = last;">
    <nav *ngIf="menuArea.display">
      <!-- SINGLE MENU ITEM -->
      <ng-container *ngIf="menuItemsPrArea[menuArea.area] === 1">

        <ng-container *ngFor="let menuItem of menuItems$ | async">
          <ng-container *ngIf="menuItem.area === menuArea.area">
            <ng-template [allowAccessFor]="menuItem.allowAccessFor">
              <ng-template [inAnyPermission]="menuItem.permissions"
                (permissionsChecked)="permissionsChecked($event, menuItem)">

                <!-- ACTION EVENT -->
                <ng-container
                  *ngIf="menuItem.isActionEvent && (menuItem | showMenuItemAction:undefined) && menuItem.display">
                  <a class="link" mat-icon-button [title]="menuItem.displayName | translate"
                    (click)="uiStore.setPackageDrawerStatus(false); actionEvent({ action: menuItem.action, _this: menuItem._this })">
                    <mat-icon aria-label="menuItem.displayName | translate">{{ menuArea.icon }}</mat-icon>
                  </a>
                </ng-container>

                <!-- URL EVENT -->
                <ng-container *ngIf="!menuItem.isActionEvent && menuItem.display">
                  <a class="link" mat-icon-button [title]="menuItem.displayName | translate"
                    [routerLink]="[menuItem.url]" (click)="uiStore.setPackageDrawerStatus(false)">
                    <mat-icon aria-label="menuItem.displayName | translate">{{ menuArea.icon }}</mat-icon>
                  </a>
                </ng-container>
              </ng-template>
            </ng-template>
          </ng-container>
        </ng-container>
      </ng-container>

      <!-- MULTIPLE MENU ITEMS -->
      <ng-container *ngIf="menuItemsPrArea[menuArea.area] > 1">

        <!-- SHOW MAT MENU -->
        <button class="link" mat-icon-button [matMenuTriggerFor]="loginMenu">
          <mat-icon>{{ menuArea.icon }}</mat-icon>
        </button>

        <mat-menu overlapTrigger="false" #loginMenu="matMenu">
          <ng-container *ngFor="let menuItem of menuItems$ | async">
            <ng-container *ngIf="menuItem.area === menuArea.area">
              <ng-template [allowAccessFor]="menuItem.allowAccessFor">
                <ng-template [inAnyPermission]="menuItem.permissions"
                  (permissionsChecked)="permissionsChecked($event, menuItem)">

                  <!-- ACTION EVENT -->
                  <ng-container
                    *ngIf="menuItem.isActionEvent && (menuItem | showMenuItemAction:undefined) && menuItem.display">
                    <button mat-menu-item
                      (click)="uiStore.setPackageDrawerStatus(false); actionEvent({ action: menuItem.action, _this: menuItem._this })"
                      [title]="menuItem.displayName | translate">
                      {{ menuItem.displayName | translate }}
                    </button>
                  </ng-container>

                  <!-- URL EVENT -->
                  <ng-container *ngIf="!menuItem.isActionEvent && menuItem.display">
                    <button mat-menu-item [routerLink]="[menuItem.url]" (click)="uiStore.setPackageDrawerStatus(false)"
                      [title]="menuItem.displayName | translate">
                      {{ menuItem.displayName | translate }}
                    </button>
                  </ng-container>

                </ng-template>
              </ng-template>
            </ng-container>
          </ng-container>
        </mat-menu>
      </ng-container>

    </nav>
  </ng-container>

  <!-- ACCOUNT -->
  <ng-container *isAuthenticated>
    <button class="link" mat-icon-button [matMenuTriggerFor]="accountMenu">
      <mat-icon>account_circle</mat-icon>
    </button>
    <mat-menu overlapTrigger="false" #accountMenu="matMenu">
      <button mat-menu-item *ngFor="let accountPackage of accountPackages$ | async"
        [routerLink]="['/' + accountPackage.path]">{{ accountPackage.name }}</button>
      <button mat-menu-item class="non-anchor" (click)="logout()" [routerLink]="['/']">{{
        'UI.TOP_BAR.LOG_OUT'| translate }}</button>
    </mat-menu>
  </ng-container>
</nav>

<ss-package-drawer></ss-package-drawer>